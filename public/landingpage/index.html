<!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-29EHQVF8J1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-29EHQVF8J1');
    </script>
    <title>Fruta no pé em Sanja</title>
    <meta charset="utf-8" />
    <link rel="icon" href="fruit_tree.ico" type="image/x-icon">
    <meta name="robots" content="index, follow">
    <meta name="description" content="Busque árvores com frutos perto de você em São José dos Campos.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="apple-touch-icon" sizes="180x180" href="icon_tree.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.js"></script>
    <script src="trees.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <style>
        header a, footer * {
            font-weight: bold;
            font-family: Noteworthy,serif;
            color: green !important;
        }
        header nav div, footer, body{
            background-color: lightgreen;
            border-color: lightgreen;
        }
        .author{
            font-weight: bold;
            color: green !important;
        }
        .leftFooter{
            font-weight: bold;
            color: green !important;
            font-size: 10pt;
        }
        main {
            padding-top: 70px;
        }
        .desc {
            font-family: Arial,fantasy;
            font-style: italic;
            color: green;
        }
        .imgTable {
            width: 32px;
            height: 32px;
        }

        .hideMainButton {
            display: none;
        }

        .tableHeader {
            background-color: green !important;
            color: white !important;
        }

        .imgTable {
            cursor: pointer;
        }

        #hideShow {
            background-color: lightgreen;
            color: black;
            font-size: 10px !important;
        }

        @media only screen and (min-height: 910px) {
            #map {
                height: 700px !important;
            }
        }

        .hide {
            opacity: 30%;
        }

        .info {
            font-size: 9px;
        }

        @media all and (max-width: 800px) {
            #footer-description {
                display: none !important;
            }
            .desc {
                display: none;
                font-size: 10px;
            }
            main {
                padding-top: 90px;
            }
            table td {
                font-size: 8px !important;
            }
            tr .badge {
                display: block; /* or inline-block, depending on your layout needs */
                white-space: normal;
                width: max-content;
                font-size: 9px !important;
            }

        }
    </style>
</head>
<body>
<header data-bs-theme="light">
    <nav class="navbar navbar-expand-md navbar-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="happy-orange-fruit.png" style="width: 60px; height: 60px">
                    Fruta no pé em Sanja
            </a>
            <span class="fst-italic desc">
                Mapa das árvores frutíferas em São José dos Campos
            </span>
        </div>
    </nav>
</header>
<main>
    <div id="map" style="height: 530px;"></div>
    <div class="row">
        <div class="col">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th scope="col" colspan="1" class="tableHeader">
                            <button title="Esconder ou mostrar todas as frutas" class="btnHideAll" type="button" id="hideAll">
                                <span class="btnTreeHideShow hideMainButton"><i class=" bi bi-eye-fill" ></i></span>
                                <span class="btnTreeHideShow"><i class="bi bi-eye-slash-fill" ></i></span>
                            </button>
                        </th>

                        <th scope="col"  colspan="6" class="tableHeader" style="text-align: right">
                            <i class="bi bi-info-circle-fill"></i>
                            <span class="info">Clique nos ícones abaixo para mostrar ou esconder</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <img alt="Goiaba" title="Mostrar/Esconder" src="guava.png" class="imgTable" id="goiabaButton"> Goiaba
                        <span id="goiabaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Jaca" src="jack-fruit.png" class="imgTable" id="jacaButton">Jaca
                        <span id="jacaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Laranja" src="orange.png" class="imgTable" id="laranjaButton">Laranja
                        <span id="laranjaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Manga" src="mango.png" class="imgTable" id="mangaButton">Manga
                        <span id="mangaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Abacate" src="avocado.png" class="imgTable" id="abacateButton">Abacate
                        <span id="abacateCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Pitanga" src="pitanga.png" class="imgTable" id="pitangaButton">Pitanga
                        <span id="pitangaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Mamão" src="papaya.png" class="imgTable" id="mamãoButton">Mamão
                        <span id="mamãoCount" class="badge text-bg-success">Info</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <img alt="Acerola" src="acerola.png" class="imgTable" id="acerolaButton">Acerola
                        <span id="acerolaCount"  class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Limão" src="lime.png" class="imgTable" id="limãoButton">Limão
                        <span id="limãoCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Amora" src="blackberry.png" class="imgTable" id="amoraButton">Amora
                        <span id="amoraCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Jaboticaba" src="jabuticaba.png" class="imgTable" id="jaboticabaButton">Jaboticaba
                        <span id="jaboticabaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Lichia" src="lychee.png" class="imgTable" id="lichiaButton">Lichia
                        <span id="lichiaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Mixirica" src="tangerine-fruit.png" class="imgTable" id="mixiricaButton">Mexirica
                        <span id="mixiricaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Fruta-do-conde" src="custard_apple.png" class="imgTable" id="fruta-do-condeButton">Fruta-do-conde
                         <span id="fruta-do-condeCount" class="badge text-bg-success">Info</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <img alt="caju" src="cashew.png" class="imgTable" id="cajuButton">Caju
                        <span id="cajuCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="pessego" src="peach.png" class="imgTable" id="pessegueiroButton">Pêssego
                            <span id="pessegueiroCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Coco" src="coconut.png" class="imgTable" id="coqueiro-da-bahiaButton">Coco
                            <span id="coqueiro-da-bahiaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="graviola" src="soursop.png" class="imgTable" id="graviolaButton">Graviola
                        <span id="graviolaCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="romã" src="pomegranate.png" class="imgTable" id="romãButton">Romã
                        <span id="romãCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Olho-de-dragão" src="longan.png" class="imgTable" id="olho-de-dragãoButton">Olho-de-dragão
                        <span id="olho-de-dragãoCount" class="badge text-bg-success">Info</span>
                    </td>
                    <td>
                        <img alt="Ameixa" src="plum.png" class="imgTable" id="ameixaButton">Ameixa
                        <span id="ameixaCount" class="badge text-bg-success">Info</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</main>
<footer class="d-flex flex-wrap justify-content-between align-items-center">
    <div class="col-md-4 d-flex align-items-center">
        <span class="mb-3 mb-md-0 text-body-secondary ">
            <a href="http://brunoborges.info/" class="author link-light link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">
                Criado por Bruno Borges
            </a>
        </span>
    </div>
    <div class="col-md-4 d-flex align-items-right" id="footer-description">
        <a href="https://arvores.sjc.sp.gov.br/" class="leftFooter link-light link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">
            Esse site utiliza o catálogo arbóreo da cidade de São José dos campos
        </a>
    </div>
</footer>
<script>

    const map = L.map('map').setView([-23.1791, -45.8872], 11);
    let additionalDesc = ''

    map.locate({setView: true, maxZoom: 16});

    function onLocationFound(e) {
        const radius = e.accuracy;

        L.marker(e.latlng).addTo(map)
            .bindPopup("Você está aqui").openPopup();

        L.circle(e.latlng, radius).addTo(map);
    }

    map.on('locationfound', onLocationFound);

    const guavaIcon = L.icon({
        iconUrl: 'guava.png',
        iconSize:     [70, 70],
    });

    const mangoIcon = L.icon({
        iconUrl: 'mango.png',
        iconSize:     [70, 70],
    });

    const orangeIcon = L.icon({
        iconUrl: 'orange.png',
        iconSize:     [70, 74],
    });

    const jackIcon = L.icon({
        iconUrl: 'jack-fruit.png',
        iconSize:     [70, 70],
    });

    const acerolaIcon = L.icon({
        iconUrl: 'acerola.png',
        iconSize:     [70, 70],
    });

    const jabuticabaIcon = L.icon({
        iconUrl: 'jabuticaba.png',
        iconSize:     [70, 70],
    });

    const limeIcon = L.icon({
        iconUrl: 'lime.png',
        iconSize:     [70, 70],
    });

    const condeIcon = L.icon({
        iconUrl: 'custard_apple.png',
        iconSize:     [70, 70],
    });

    const blackberryIcon = L.icon({
        iconUrl: 'blackberry.png',
        iconSize:     [70, 70],
    });

    const avocadoIcon = L.icon({
        iconUrl: 'avocado.png',
        iconSize:     [70, 70],
    });

    const pitangaIcon = L.icon({
        iconUrl: 'pitanga.png',
        iconSize:     [70, 70],
    });

    const lycheeIcon = L.icon({
        iconUrl: 'lychee.png',
        iconSize:     [70, 70],
    });

    const papayaIcon = L.icon({
        iconUrl: 'papaya.png',
        iconSize:     [70, 70],
    });

    const tangerineIcon = L.icon({
        iconUrl: 'tangerine-fruit.png',
        iconSize:     [70, 70],
    });

    const cajuIcon = L.icon({
        iconUrl: 'cashew.png',
        iconSize:     [70, 70],
    });

    const peachIcon = L.icon({
        iconUrl: 'peach.png',
        iconSize:     [70, 70],
    });

    const coqueiroIcon = L.icon({
        iconUrl: 'coconut.png',
        iconSize:     [70, 70],
    });

    const graviolaIcon = L.icon({
        iconUrl: 'soursop.png',
        iconSize:     [70, 70],
    });

    const pomegranateIcon = L.icon({
        iconUrl: 'pomegranate.png',
        iconSize:     [70, 70],
    });

    const longanIcon = L.icon({
        iconUrl: 'longan.png',
        iconSize:     [70, 70],
    });

    const plumIcon = L.icon({
        iconUrl: 'plum.png',
        iconSize:     [70, 70],
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    const countFruits = []
    const fruitGroups = []

    trees.forEach(function (tree) {
        let fruitIcon
        let skip = false

        const nameParts = tree.name.split(",")
        const fruitName = nameParts[0].toLowerCase();

        if (countFruits[fruitName] === undefined) {
            countFruits[fruitName] = 1;
        } else {
            countFruits[fruitName] =  countFruits[fruitName] + 1;
        }

        switch (tree.name) {
            case "Ameixa, Ameixeira, Abrunheiro, Abrunho":
                fruitIcon = plumIcon
                additionalDesc = 'Em algumas regiões do sudeste brasileiro, a colheita da ameixa pode começar em novembro e se estender até janeiro ou fevereiro.'
                break
            case "Olho-de-dragão, Longa":
                fruitIcon = longanIcon
                additionalDesc = 'Em geral, a colheita do longan costuma ocorrer durante os meses de janeiro a março, mas isso pode ser influenciado por fatores específicos de cada região.'
                break
            case "Romã":
                fruitIcon = pomegranateIcon
                additionalDesc = 'Em geral, a colheita da romã no Brasil costuma ocorrer entre os meses de fevereiro e abril.'
                break
            case "Graviola":
                fruitIcon = graviolaIcon
                additionalDesc = 'Em climas tropicais, onde a graviola é comumente cultivada, a colheita pode ocorrer mais de uma vez por ano. Em alguns lugares, a produção pode ser mais intensa durante os meses mais quentes do ano.'
                break
            case "Coqueiro-da-bahia":
                fruitIcon = coqueiroIcon
                additionalDesc = 'Produz cocos ao longo do ano, e não há um período de colheita específico.'
                break
            case "Pessegueiro, Pêssego":
                fruitIcon = peachIcon
                additionalDesc = 'Em geral, a colheita do pêssego costuma ocorrer entre os meses de outubro e janeiro. No entanto, essas datas podem variar um pouco de ano para ano e dependem de fatores como o clima'
                break
            case "Caju, Cajueiro":
                fruitIcon = cajuIcon
                additionalDesc = 'Em geral, a colheita do caju ocorre entre os meses de setembro e dezembro em muitas áreas tropicais. No entanto, em algumas regiões, pode estender-se até janeiro.'
                break
            case "Goiaba, Goiabeira":
                fruitIcon = guavaIcon
                additionalDesc = 'Pode ser encontrada ao longo do ano, com uma produção mais concentrada nos meses mais quentes'
                break
            case "Jaca, Jaqueira":
                fruitIcon = jackIcon
                additionalDesc = 'Costuma frutificar na primavera e no verão.'
                break
            case "Laranja, Laranjeira":
                fruitIcon = orangeIcon
                additionalDesc = 'Podem ser encontradas durante grande parte do ano.'
                break
            case "Manga, Mangueira":
                fruitIcon = mangoIcon
                additionalDesc = 'Geralmente, a safra de manga ocorre na primavera e no verão.'
                break
            case "Acerola":
                fruitIcon = acerolaIcon
                additionalDesc = 'Pode ser encontrada durante o ano, mas a produção é geralmente mais intensa na primavera e no verão.'
                break
            case "Jaboticaba, Jabuticaba, Jaboticabeira, Jabuticabeira":
                fruitIcon = jabuticabaIcon
                additionalDesc = 'Costuma frutificar na primavera e no início do verão.'
                break
            case "Limão, Limoeiro":
                fruitIcon = limeIcon
                additionalDesc = 'Pode ser encontrado ao longo do ano, mas algumas variedades têm uma produção mais intensa no inverno.'
                break
            case "Amora, Amoreira":
                fruitIcon = blackberryIcon
                additionalDesc = 'A produção principal ocorre na primavera e no verão.'
                break
            case "Fruta-do-conde, Ata, Pinha":
                fruitIcon = condeIcon
                additionalDesc = 'Pode ser encontrada ao longo do ano, mas a produção é geralmente mais intensa no verão.'
                break
            case "Abacate, Abacateiro":
                fruitIcon = avocadoIcon
                additionalDesc = 'Dependendo da variedade, os abacates podem ser encontrados durante o ano, com uma produção mais intensa na primavera e no verão.'
                break
            case "Pitanga, Pitangueira":
                fruitIcon = pitangaIcon
                additionalDesc = 'Maior incidência de frutas maduras nos meses mais quentes do ano'
                break
            case "Lichia, Lixia":
                fruitIcon = lycheeIcon
                additionalDesc = 'A lichieira é uma planta que geralmente dá frutos uma vez por ano. Em geral, as lichias costumam frutificar durante o verão'
                break
            case "Mamão, Mamoeiro":
                fruitIcon = papayaIcon
                additionalDesc = 'Os mamoeiros geralmente produzem frutos de forma contínua, sem uma estação específica para a frutificação.'
                break
            case "Mixirica, Mexirica":
                fruitIcon = tangerineIcon
                additionalDesc = 'Em geral, as mixiricas tendem a produzir frutos no outono e inverno'
                break
            default:
                skip = true
                break;
        }

        if (!skip) {
            const marker = L.marker([tree.latitude.replace(",", "."), tree.longitude.replace(",", ".")], {icon: fruitIcon})
                .bindPopup("<b>" +  tree.name + "</b>: " + additionalDesc)

            if (fruitGroups[fruitName] === undefined) {
                fruitGroups[fruitName] = [marker]
            } else{
                fruitGroups[fruitName].push(marker);
            }
        }
    });

    Object.keys(fruitGroups).forEach(function (fruit) {
        const feature = L.featureGroup(fruitGroups[fruit])
            .openPopup()
            .addTo(map)

        const button = document.getElementById(fruit + 'Button');

        if (button) {
            button.addEventListener('click', function () {
                let element = document.getElementById(fruit + 'Button');

                if (element.classList.contains("hide")) {
                    feature.addTo(map);
                    element.classList.remove("hide");
                } else {
                    feature.removeFrom(map);
                    element.classList.add("hide");
                }
            })
        } else {
            console.log("Could not find " + fruit);
        }
    });

    const buttonHideAll = document.getElementById("hideAll");

    buttonHideAll.addEventListener('click', function () {
        Object.keys(fruitGroups).forEach(function (fruit) {
            let element = document.getElementById(fruit + 'Button');
            element.click();
        });


        const collection = document.getElementsByClassName("btnTreeHideShow");

        for (let i = 0; i < collection.length; i++) {
            if (collection[i].classList.contains('hideMainButton')) {
                collection[i].classList.remove("hideMainButton");
            } else {
                collection[i].classList.add("hideMainButton");
            }
        }
    });

    Object.keys(countFruits).forEach(function (fruit) {
        let fruitElement = document.getElementById(fruit + "Count")
        if (fruitElement) {
            fruitElement.innerText = countFruits[fruit];
        }
    })
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
